<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å® ç‰©æ´»åŠ¨è½¨è¿¹ - å¤šå¤§</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://webapi.amap.com/maps?v=2.0&key=6c1576bd552c7e09cbacc760e14f6618&plugin=AMap.Scale"></script>
    <style>
        /* å¼ºåˆ¶éšè—æ‰€æœ‰æ»šåŠ¨æ¡ */
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        *::-webkit-scrollbar {
            display: none;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        .pet-tracker-container {
            width: 375px;
            height: 812px;
            margin: 0 auto;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
            border-radius: 30px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            position: relative;
        }
        
        /* æ–°çš„é¡¶éƒ¨æ§åˆ¶æ  */
        .top-control-bar {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            height: 120px;
            padding: 44px 20px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
            position: relative;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 44px;
            padding: 0 20px;
        }
        
        .status-left {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .status-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        
        .date-time-control {
            flex: 1;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 10px 14px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-section {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }
        
        .date-btn {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .date-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .date-display {
            font-size: 13px;
            font-weight: 600;
            color: white;
            min-width: 70px;
            text-align: center;
        }
        
        .time-section {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .play-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .play-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ff6b35;
        }
        
        .play-btn:hover {
            background: white;
            transform: scale(1.1);
        }
        
        .play-btn.playing {
            background: #ff6b35;
            color: white;
        }
        
        .time-slider-mini {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
            margin: 0 4px;
        }
        
        .time-progress {
            height: 100%;
            background: linear-gradient(90deg, #fff 0%, rgba(255,255,255,0.8) 100%);
            border-radius: 3px;
            position: relative;
            transition: width 0.5s ease;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }
        
        .time-progress::after {
            content: '';
            position: absolute;
            right: -4px;
            top: -3px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #ff6b35;
        }
        
        .time-display {
            font-size: 13px;
            font-weight: 600;
            color: white;
            min-width: 35px;
        }
        
        .top-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .top-action-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }
        
        /* åœ°å›¾å®¹å™¨ - ç°åœ¨å æ®æ›´å¤šç©ºé—´ */
        .map-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #amap-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        .amap-logo, .amap-copyright {
            opacity: 0.3 !important;
        }
        
        /* å·¦ä¾§å‚ç›´æ§åˆ¶æ  */
        .left-controls {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 20;
        }
        
        .left-control-item {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            flex-direction: column;
            gap: 2px;
        }
        
        .left-control-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .left-control-item.active {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
        }
        
        .left-control-item i {
            font-size: 12px;
        }
        
        .left-control-item span {
            font-size: 8px;
            font-weight: 500;
        }
        
        /* å³ä¸Šè§’å¿«æ·æŒ‰é’® */
        .quick-actions {
            position: absolute;
            right: 16px;
            top: 16px;
            display: flex;
            gap: 8px;
            z-index: 20;
        }
        
        .quick-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .quick-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* åº•éƒ¨é›†æˆé¢æ¿ */
        .bottom-panel {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 16px 20px 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 50;
        }
        
        .pet-info-compact {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 107, 53, 0.05);
            border-radius: 12px;
            padding: 10px 12px;
            border: 1px solid rgba(255, 107, 53, 0.1);
        }
        
        .pet-avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .pet-info-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pet-basic-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .pet-name-small {
            font-size: 13px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .pet-steps {
            font-size: 11px;
            color: #666;
        }
        
        .pet-battery {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: #666;
        }
        
        .battery-mini {
            width: 12px;
            height: 8px;
            border: 1px solid #ddd;
            border-radius: 1px;
            position: relative;
        }
        
        .battery-mini::after {
            content: '';
            position: absolute;
            right: -2px;
            top: 2px;
            width: 1px;
            height: 4px;
            background: #ddd;
            border-radius: 0 1px 1px 0;
        }
        
        .battery-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: #ff6b35;
            border-radius: 1px;
            transition: width 0.3s ease;
        }
        
        .sync-btn-small {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(52, 199, 89, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .sync-btn-small:hover {
            background: rgba(52, 199, 89, 0.2);
            transform: rotate(90deg);
        }
        
        .bottom-nav {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 8px 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            z-index: 50;
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 320px;
        }
        
        .nav-items {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .nav-item {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            flex-shrink: 0;
            border: none;
            background: transparent;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(255, 107, 53, 0.4);
            transform: scale(1.1);
        }
        
        .nav-item:not(.active) {
            color: #999;
            background: transparent;
        }
        
        .nav-item:not(.active):hover {
            color: #666;
            background: rgba(0, 0, 0, 0.05);
            transform: scale(1.05);
        }
        
        /* å¢å¼ºè½¨è¿¹æ’­æ”¾è§†è§‰æ•ˆæœ */
        .track-path {
            stroke: #ff6b35;
            stroke-width: 4;
            fill: none;
            stroke-dasharray: 10, 5;
            animation: dashMove 2s linear infinite;
            opacity: 0.9;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .track-path-shadow {
            stroke: rgba(255, 107, 53, 0.3);
            stroke-width: 8;
            fill: none;
            opacity: 0.6;
        }
        
        .track-progress-path {
            stroke: #dc2626;
            stroke-width: 5;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            opacity: 1;
        }
        
        @keyframes dashMove {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -15; }
        }
        
        /* è½¨è¿¹ç‚¹æ ·å¼ */
        .track-point {
            width: 8px;
            height: 8px;
            background: #fff;
            border: 2px solid #ff6b35;
            border-radius: 50%;
            position: absolute;
            z-index: 10;
            animation: track-point-pulse 2s ease-in-out infinite;
        }
        
        .track-point.active {
            background: #ff6b35;
            border-color: #fff;
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.6);
            animation: track-point-active 1s ease-in-out infinite;
        }
        
        @keyframes track-point-pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
        }
        
        @keyframes track-point-active {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        
        /* è½¨è¿¹ä¿¡æ¯æç¤º */
        .track-info {
            position: absolute;
            right: 16px;
            bottom: 120px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 11px;
            color: #333;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            z-index: 20;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .track-info.show {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pet-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="pet-tracker-container">
        <!-- æ–°çš„é¡¶éƒ¨æ§åˆ¶æ  -->
        <div class="top-control-bar">
            <!-- çŠ¶æ€æ  -->
            <div class="status-bar">
                <div class="status-left">
                    <span>9:41</span>
                </div>
                <div class="status-right">
                    <div class="flex items-center gap-1">
                        <div class="w-1 h-1 bg-white rounded-full opacity-80"></div>
                        <div class="w-1 h-1 bg-white rounded-full opacity-80"></div>
                        <div class="w-1 h-1 bg-white rounded-full opacity-80"></div>
                        <div class="w-1 h-1 bg-white rounded-full opacity-40"></div>
                    </div>
                    <i class="fas fa-wifi text-sm opacity-80"></i>
                    <div class="w-6 h-3 border border-white rounded-sm relative opacity-80">
                        <div class="absolute right-0 top-0 w-4 h-full bg-white rounded-sm"></div>
                    </div>
                </div>
            </div>
            
            <!-- é›†æˆçš„æ—¥æœŸæ—¶é—´æ§åˆ¶ -->
            <div class="control-row">
                <div class="date-time-control">
                    <div class="date-section">
                        <button class="date-btn" onclick="changeDate(-1)">
                            <i class="fas fa-chevron-left text-white text-xs"></i>
                        </button>
                        <span class="date-display" id="currentDate">05-16</span>
                        <button class="date-btn" onclick="changeDate(1)">
                            <i class="fas fa-chevron-right text-white text-xs"></i>
                        </button>
                    </div>
                    <div class="text-white opacity-60">|</div>
                    <div class="time-section">
                        <div class="play-controls">
                            <button class="play-btn" id="playBtn" onclick="togglePlay()">
                                <i class="fas fa-play text-xs"></i>
                            </button>
                        </div>
                        <span class="time-display" id="currentTime">12:43</span>
                        <div class="time-slider-mini" onclick="handleTimeClick(event)">
                            <div class="time-progress" id="timeProgress" style="width: 53%"></div>
                        </div>
                    </div>
                </div>
                <button class="top-action-btn" onclick="centerLocation()">
                    <i class="fas fa-crosshairs text-white text-sm"></i>
                </button>
                <button class="top-action-btn" onclick="refreshTrack()">
                    <i class="fas fa-sync text-white text-sm"></i>
                </button>
            </div>
        </div>

        <!-- åœ°å›¾ä¸»ç•Œé¢ - ç°åœ¨å æ®æ›´å¤šç©ºé—´ -->
        <div class="map-container">
            <!-- é«˜å¾·åœ°å›¾å®¹å™¨ -->
            <div id="amap-container"></div>
            
            <!-- å·¦ä¾§å‚ç›´æ§åˆ¶æ  -->
            <div class="left-controls">
                <button class="left-control-item" onclick="petSocial()">
                    <i class="fas fa-heart text-gray-500"></i>
                    <span>äº¤å‹</span>
                </button>
                <button class="left-control-item active" onclick="activityTrack()">
                    <i class="fas fa-route text-white"></i>
                    <span>è½¨è¿¹</span>
                </button>
                <button class="left-control-item" onclick="petTravel()">
                    <i class="fas fa-map-marker-alt text-gray-500"></i>
                    <span>å‡ºè¡Œ</span>
                </button>
            </div>
            
            <!-- å³ä¸Šè§’å¿«æ·æŒ‰é’® -->
            <div class="quick-actions">
                <button class="quick-btn" onclick="showDevice()">
                    <i class="fas fa-mobile-alt text-gray-600 text-xs"></i>
                </button>
            </div>
            
            <!-- è½¨è¿¹ä¿¡æ¯æç¤º -->
            <div class="track-info" id="trackInfo">
                <div>è½¨è¿¹æ’­æ”¾ä¸­...</div>
                <div>é€Ÿåº¦: <span id="trackSpeed">1x</span></div>
            </div>
        </div>
        
        <!-- åº•éƒ¨é›†æˆé¢æ¿ -->
        <div class="bottom-panel">
            <!-- ç´§å‡‘çš„å® ç‰©ä¿¡æ¯ -->
            <div class="pet-info-compact">
                <div class="pet-avatar-small">
                    <i class="fas fa-dog text-white text-sm"></i>
                </div>
                <div class="pet-info-content">
                    <div class="pet-basic-info">
                        <div class="pet-name-small">ç³¯ç³¯</div>
                        <div class="pet-steps">ä»Šæ—¥ <strong>2705</strong> Steps</div>
                    </div>
                    <div class="pet-battery">
                        <div class="battery-mini">
                            <div class="battery-fill" style="width: 20%"></div>
                        </div>
                        <span>20%</span>
                    </div>
                    <button class="sync-btn-small" onclick="syncData()">
                        <i class="fas fa-sync-alt text-green-500 text-xs"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <div class="bottom-nav">
            <div class="nav-items">
                <button class="nav-item" onclick="goHome()">
                    <i class="fas fa-home text-base"></i>
                </button>
                <button class="nav-item" onclick="showHistory()">
                    <i class="fas fa-list text-base"></i>
                </button>
                <button class="nav-item active" onclick="showMap()">
                    <i class="fas fa-location-dot text-base"></i>
                </button>
                <button class="nav-item" onclick="showProfile()">
                    <i class="fas fa-user text-lg"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        let map;
        let trackPolyline;
        let trackProgressPolyline;
        let startMarker;
        let endMarker;
        let zooMarker;
        let currentTimeMarker;
        let currentTimeValue = 763;
        let isPlaying = false;
        let playInterval;
        let playSpeed = 1;
        
        // è½¨è¿¹æ•°æ®ç‚¹
        const trackData = [
            { position: [121.625856, 29.870388], time: '09:30', timestamp: 570 },
            { position: [121.627856, 29.872388], time: '10:15', timestamp: 615 },
            { position: [121.630856, 29.874388], time: '11:00', timestamp: 660 },
            { position: [121.633856, 29.876388], time: '11:45', timestamp: 705 },
            { position: [121.635856, 29.878388], time: '12:30', timestamp: 750 },
            { position: [121.637856, 29.880388], time: '12:43', timestamp: 763 }
        ];
        
        const zooLocation = [121.645856, 29.883388];
        let currentDate = new Date('2024-05-16');

        // åˆå§‹åŒ–é«˜å¾·åœ°å›¾
        function initMap() {
            try {
                map = new AMap.Map('amap-container', {
                    center: [121.631856, 29.875388],
                    zoom: 15,
                    mapStyle: 'amap://styles/normal',
                    showLabel: true,
                    scrollWheel: true,
                    touchZoom: true,
                    doubleClickZoom: true,
                    keyboardEnable: true,
                    dragEnable: true,
                    zoomEnable: true,
                    rotateEnable: true,
                    animateEnable: true,
                    jogEnable: true,
                    pitchEnable: false,
                    buildingAnimation: true,
                    features: ['bg', 'road', 'building', 'point']
                });

                // æ·»åŠ è½¨è¿¹å’Œæ ‡è®°
                addTrackAndMarkers();

                // åœ°å›¾åŠ è½½å®Œæˆå›è°ƒ
                map.on('complete', function() {
                    console.log('å® ç‰©æ´»åŠ¨è½¨è¿¹åœ°å›¾åŠ è½½å®Œæˆ');
                });

            } catch (error) {
                console.error('é«˜å¾·åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('amap-container').innerHTML = `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: #f8f9fa;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: #6c757d;
                        font-size: 14px;
                    ">
                        åœ°å›¾åŠ è½½ä¸­...
                    </div>
                `;
            }
        }

        // æ·»åŠ è½¨è¿¹å’Œæ ‡è®°
        function addTrackAndMarkers() {
            if (!map) return;

            // åˆ›å»ºå®Œæ•´è½¨è¿¹çº¿ï¼ˆèƒŒæ™¯ï¼‰
            const trackPath = trackData.map(point => point.position);
            trackPolyline = new AMap.Polyline({
                path: trackPath,
                strokeColor: 'rgba(255, 107, 53, 0.3)',
                strokeWeight: 6,
                strokeStyle: 'solid',
                strokeOpacity: 0.4,
                lineJoin: 'round',
                lineCap: 'round'
            });

            // åˆ›å»ºè¿›åº¦è½¨è¿¹çº¿ï¼ˆå‰æ™¯ï¼‰
            trackProgressPolyline = new AMap.Polyline({
                path: [trackData[0].position],
                strokeColor: '#ff6b35',
                strokeWeight: 4,
                strokeStyle: 'solid',
                strokeOpacity: 1,
                lineJoin: 'round',
                lineCap: 'round'
            });

            // èµ·ç‚¹æ ‡è®°
            startMarker = new AMap.Marker({
                position: trackData[0].position,
                title: 'èµ·ç‚¹',
                content: `
                    <div style="
                        width: 16px; 
                        height: 16px; 
                        border-radius: 50%; 
                        background: #00bcd4;
                        border: 3px solid white;
                        box-shadow: 0 0 12px rgba(0, 188, 212, 0.6);
                        animation: track-point-pulse 2s ease-in-out infinite;
                    "></div>
                `
            });

            // å½“å‰ä½ç½®æ ‡è®°ï¼ˆåŠ¨æ€ï¼‰
            endMarker = new AMap.Marker({
                position: trackData[trackData.length - 1].position,
                title: 'å½“å‰ä½ç½®',
                content: `
                    <div style="
                        width: 20px; 
                        height: 20px; 
                        border-radius: 50%; 
                        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
                        border: 3px solid white;
                        box-shadow: 0 0 16px rgba(255, 107, 53, 0.8);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: pet-pulse 1.5s ease-in-out infinite;
                        position: relative;
                    ">
                        <i class="fas fa-dog" style="color: white; font-size: 8px;"></i>
                        <div style="
                            position: absolute;
                            top: -8px;
                            left: -8px;
                            width: 32px;
                            height: 32px;
                            border: 2px solid rgba(255, 107, 53, 0.3);
                            border-radius: 50%;
                            animation: ripple 2s ease-out infinite;
                        "></div>
                    </div>
                `
            });

            // åŠ¨ç‰©å›­æ ‡è®°
            zooMarker = new AMap.Marker({
                position: zooLocation,
                title: 'å®æ³¢é‡ç”ŸåŠ¨ç‰©å›­',
                content: `
                    <div style="
                        background: #4caf50;
                        color: white;
                        padding: 6px 12px;
                        border-radius: 16px;
                        font-size: 11px;
                        font-weight: 500;
                        box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
                        display: flex;
                        align-items: center;
                        gap: 4px;
                        white-space: nowrap;
                    ">
                        <i class="fas fa-paw" style="font-size: 10px;"></i>
                        å®æ³¢é‡ç”ŸåŠ¨ç‰©å›­
                    </div>
                `
            });

            // æ·»åŠ è½¨è¿¹ç‚¹æ ‡è®°
            trackData.forEach((point, index) => {
                if (index > 0 && index < trackData.length - 1) {
                    const pointMarker = new AMap.Marker({
                        position: point.position,
                        title: `è½¨è¿¹ç‚¹ ${index}`,
                        content: `
                            <div class="track-point" data-index="${index}">
                                <div style="
                                    position: absolute;
                                    bottom: 15px;
                                    left: 50%;
                                    transform: translateX(-50%);
                                    background: rgba(255, 107, 53, 0.9);
                                    color: white;
                                    padding: 2px 6px;
                                    border-radius: 8px;
                                    font-size: 9px;
                                    font-weight: 500;
                                    white-space: nowrap;
                                ">${point.time}</div>
                            </div>
                        `
                    });
                    map.add(pointMarker);
                }
            });

            // æ·»åŠ åˆ°åœ°å›¾
            map.add([trackPolyline, trackProgressPolyline, startMarker, endMarker, zooMarker]);
        }

        // æ’­æ”¾/æš‚åœæ§åˆ¶
        function togglePlay() {
            const playBtn = document.getElementById('playBtn');
            const trackInfo = document.getElementById('trackInfo');
            
            if (isPlaying) {
                // æš‚åœæ’­æ”¾
                isPlaying = false;
                clearInterval(playInterval);
                playBtn.innerHTML = '<i class="fas fa-play text-xs"></i>';
                playBtn.classList.remove('playing');
                trackInfo.classList.remove('show');
                showNotification('â¸ï¸ è½¨è¿¹æ’­æ”¾å·²æš‚åœ');
            } else {
                // å¼€å§‹æ’­æ”¾
                isPlaying = true;
                playBtn.innerHTML = '<i class="fas fa-pause text-xs"></i>';
                playBtn.classList.add('playing');
                trackInfo.classList.add('show');
                startAutoPlay();
                showNotification('â–¶ï¸ å¼€å§‹æ’­æ”¾è½¨è¿¹');
            }
        }

        // è‡ªåŠ¨æ’­æ”¾è½¨è¿¹
        function startAutoPlay() {
            const startTime = 570; // 09:30
            const endTime = 763; // 12:43
            let currentTime = Math.max(currentTimeValue, startTime);
            
            playInterval = setInterval(() => {
                if (currentTime >= endTime) {
                    // æ’­æ”¾å®Œæˆï¼Œé‡æ–°å¼€å§‹
                    currentTime = startTime;
                    showNotification('ğŸ”„ è½¨è¿¹æ’­æ”¾å®Œæˆï¼Œé‡æ–°å¼€å§‹');
                }
                
                currentTime += playSpeed;
                currentTimeValue = currentTime;
                updateTime(currentTime);
                updateTrackProgress(currentTime);
                
            }, 100); // 100msé—´éš”
        }

        // æ›´æ–°è½¨è¿¹æ’­æ”¾è¿›åº¦
        function updateTrackProgress(timeValue) {
            if (!trackProgressPolyline) return;
            
            // è®¡ç®—å½“å‰åº”è¯¥æ˜¾ç¤ºåˆ°å“ªä¸ªè½¨è¿¹ç‚¹
            let currentIndex = 0;
            for (let i = 0; i < trackData.length; i++) {
                if (timeValue >= trackData[i].timestamp) {
                    currentIndex = i;
                } else {
                    break;
                }
            }
            
            // æ›´æ–°è¿›åº¦è½¨è¿¹çº¿
            const progressPath = trackData.slice(0, currentIndex + 1).map(point => point.position);
            if (progressPath.length > 1) {
                trackProgressPolyline.setPath(progressPath);
            }
            
            // æ›´æ–°è½¨è¿¹ç‚¹çŠ¶æ€
            document.querySelectorAll('.track-point').forEach((point, index) => {
                if (index + 1 <= currentIndex) {
                    point.classList.add('active');
                } else {
                    point.classList.remove('active');
                }
            });
        }

        // å¤„ç†æ—¶é—´ç‚¹å‡»
        function handleTimeClick(event) {
            const rect = event.target.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = x / rect.width;
            const newTimeValue = Math.round(570 + percentage * (763 - 570)); // é™åˆ¶åœ¨è½¨è¿¹æ—¶é—´èŒƒå›´å†…
            
            currentTimeValue = newTimeValue;
            updateTime(newTimeValue);
            updateTrackProgress(newTimeValue);
        }

        // æ›´æ–°æ—¶é—´
        function updateTime(value) {
            const hours = Math.floor(value / 60);
            const minutes = value % 60;
            const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            
            document.getElementById('currentTime').textContent = timeStr;
            
            // æ›´æ–°æ—¶é—´è¿›åº¦æ¡
            const percentage = ((value - 570) / (763 - 570)) * 100;
            document.getElementById('timeProgress').style.width = Math.max(0, Math.min(100, percentage)) + '%';
            
            // æ›´æ–°å® ç‰©ä½ç½®
            updatePetPosition(value);
        }

        // æ›´æ–°å® ç‰©ä½ç½®
        function updatePetPosition(timeValue) {
            // æ ¹æ®æ—¶é—´è®¡ç®—å® ç‰©åœ¨è½¨è¿¹ä¸Šçš„ä½ç½®
            let currentPos = trackData[0].position;
            
            for (let i = 0; i < trackData.length - 1; i++) {
                if (timeValue >= trackData[i].timestamp && timeValue <= trackData[i + 1].timestamp) {
                    // åœ¨ä¸¤ä¸ªè½¨è¿¹ç‚¹ä¹‹é—´ï¼Œè¿›è¡Œæ’å€¼
                    const progress = (timeValue - trackData[i].timestamp) / (trackData[i + 1].timestamp - trackData[i].timestamp);
                    const lat = trackData[i].position[1] + (trackData[i + 1].position[1] - trackData[i].position[1]) * progress;
                    const lng = trackData[i].position[0] + (trackData[i + 1].position[0] - trackData[i].position[0]) * progress;
                    currentPos = [lng, lat];
                    break;
                } else if (timeValue >= trackData[i].timestamp) {
                    currentPos = trackData[i].position;
                }
            }
            
            if (endMarker && currentPos) {
                endMarker.setPosition(currentPos);
            }
        }

        // æ›´æ”¹æ—¥æœŸ
        function changeDate(direction) {
            const newDate = new Date(currentDate);
            newDate.setDate(newDate.getDate() + direction);
            currentDate = newDate;
            
            const dateStr = `${(newDate.getMonth() + 1).toString().padStart(2, '0')}-${newDate.getDate().toString().padStart(2, '0')}`;
            document.getElementById('currentDate').textContent = dateStr;
            
            showNotification(`åˆ‡æ¢åˆ° ${dateStr}`);
        }

        // å®šä½åˆ°è½¨è¿¹
        function centerLocation() {
            if (map && trackPolyline) {
                map.setFitView([trackPolyline]);
                showNotification('ğŸ¯ å·²å®šä½åˆ°æ´»åŠ¨è½¨è¿¹');
            }
        }

        // åˆ·æ–°è½¨è¿¹
        function refreshTrack() {
            showNotification('ğŸ”„ æ­£åœ¨åˆ·æ–°æ´»åŠ¨è½¨è¿¹');
        }

        // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
        function showDevice() {
            showNotification('ğŸ“± è®¾å¤‡ä¿¡æ¯');
        }

        // åŒæ­¥æ•°æ®
        function syncData() {
            const button = event.target.closest('.sync-btn-small');
            button.style.transform = 'rotate(360deg)';
            setTimeout(() => {
                button.style.transform = 'rotate(0deg)';
            }, 600);
            
            showNotification('ğŸ“Š æ•°æ®åŒæ­¥ä¸­...');
        }

        // å® ç‰©äº¤å‹
        function petSocial() {
            updateLeftControls('social');
            showNotification('ğŸ’• å® ç‰©äº¤å‹');
        }

        // æ´»åŠ¨è½¨è¿¹
        function activityTrack() {
            showNotification('ğŸ“ æ´»åŠ¨è½¨è¿¹');
        }

        // å® ç‰©å‡ºè¡Œ
        function petTravel() {
            updateLeftControls('travel');
            showNotification('ğŸš— å® ç‰©å‡ºè¡Œ');
        }

        // æ›´æ–°å·¦ä¾§æ§åˆ¶æŒ‰é’®çŠ¶æ€
        function updateLeftControls(activeType) {
            const buttons = document.querySelectorAll('.left-control-item');
            buttons.forEach(button => {
                button.classList.remove('active');
                const text = button.textContent;
                if (activeType === 'social' && text.includes('äº¤å‹')) {
                    button.classList.add('active');
                } else if (activeType === 'activity' && text.includes('è½¨è¿¹')) {
                    button.classList.add('active');
                } else if (activeType === 'travel' && text.includes('å‡ºè¡Œ')) {
                    button.classList.add('active');
                }
            });
        }

        // å¯¼èˆªåŠŸèƒ½
        function goHome() {
            showNotification('ğŸ  é¦–é¡µ');
        }

        function showHistory() {
            showNotification('ğŸ“‹ å†å²è®°å½•');
        }

        function showMap() {
            showNotification('ğŸ—ºï¸ åœ°å›¾');
        }

        function showProfile() {
            showNotification('ğŸ‘¤ ä¸ªäººèµ„æ–™');
        }

        // æ˜¾ç¤ºé€šçŸ¥æ¶ˆæ¯
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.85);
                color: white;
                padding: 12px 20px;
                border-radius: 16px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: notification-show 2s ease-out forwards;
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 2000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes notification-show {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            }
            @keyframes ripple {
                0% { transform: scale(1); opacity: 1; }
                100% { transform: scale(2); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // é¡µé¢åŠ è½½åŠ¨ç”»
        window.addEventListener('load', () => {
            document.querySelector('.pet-tracker-container').style.opacity = '0';
            document.querySelector('.pet-tracker-container').style.transform = 'scale(0.95)';
            document.querySelector('.pet-tracker-container').style.transition = 'all 0.4s ease';
            
            setTimeout(() => {
                document.querySelector('.pet-tracker-container').style.opacity = '1';
                document.querySelector('.pet-tracker-container').style.transform = 'scale(1)';
            }, 100);
        });

        // åˆå§‹åŒ–åœ°å›¾
        setTimeout(initMap, 100);
    </script>
</body>
</html> 